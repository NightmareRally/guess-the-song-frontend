<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guess the Song Game</title>
  <style>
    /* Base Styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212;
      color: #ddd;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      user-select: none;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1 {
      text-align: center;
      margin-bottom: 25px;
      font-weight: 700;
      letter-spacing: 1.5px;
      color: #b892ff;
      text-shadow: 0 0 10px #b892ff66;
      font-size: 2.25rem;
    }

    input[type="text"],
    select {
      background-color: #1f1f2e;
      border: 1.5px solid #6f47ff;
      color: #eee;
      padding: 12px 15px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 15px;
      border-radius: 8px;
      transition: border-color 0.3s ease;
    }

    input[type="text"]:focus,
    select:focus {
      border-color: #b892ff;
      outline: none;
      box-shadow: 0 0 8px #b892ff88;
    }

    button {
      background-color: #6f47ff;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 18px;
      font-size: 16px;
      cursor: pointer;
      margin: 8px 0;
      font-weight: 600;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
      box-shadow: 0 0 5px #6f47ffcc;
      flex-shrink: 0;
    }

    button:hover {
      background-color: #b892ff;
      box-shadow: 0 0 15px #b892ffdd;
    }

    #gameControls {
      margin-top: 30px;
      border: 1.5px solid #6f47ff;
      border-radius: 12px;
      padding: 25px 20px 30px 20px;
      background: #1a1a2e;
      box-shadow: 0 0 15px #6f47ff44;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    #scoreDisplay {
      font-size: 20px;
      color: #b892ff;
      font-weight: 700;
      margin-bottom: 15px;
      display: inline-block;
      user-select: text;
    }

    #answer,
    #feedback,
    #hintDuration,
    #message {
      margin-top: 12px;
      font-weight: 600;
      color: #ddd;
      user-select: text;
    }

    .autocomplete-list {
      border: 1px solid #5548ff;
      max-height: 150px;
      overflow-y: auto;
      position: absolute;
      background: #2c2c4a;
      width: 100%;
      z-index: 1000;
      border-radius: 8px;
      user-select: none;
      box-sizing: border-box;
    }

    .autocomplete-item {
      padding: 10px 12px;
      cursor: pointer;
      color: #ddd;
      transition: background-color 0.2s ease;
    }

    .autocomplete-item:hover {
      background-color: #6f47ffaa;
      color: white;
    }

    .input-container {
      position: relative;
      margin-bottom: 20px;
      width: 100%;
    }

    #loader {
      display: none;
      margin: 20px auto;
      width: 45px;
      height: 45px;
      border: 5px solid #6f47ff;
      border-top: 5px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    #continueBtn {
      display: none;
    }

    /* Flex layout for buttons row */
    #buttonRow {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    #buttonRow > button {
      flex: 1 1 120px;
      min-width: 120px;
    }

    /* Smaller fonts and spacing on small devices */
    @media (max-width: 400px) {
      body {
        padding: 15px 12px;
      }

      h1 {
        font-size: 1.8rem;
        margin-bottom: 20px;
      }

      input[type="text"],
      select {
        font-size: 14px;
        padding: 10px 12px;
      }

      button {
        font-size: 14px;
        padding: 10px 14px;
        min-width: 100px;
      }

      #scoreDisplay {
        font-size: 18px;
      }
    }

    /* Adjust autocomplete z-index on mobile to ensure visibility */
    @media (max-width: 600px) {
      .autocomplete-list {
        font-size: 14px;
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Multiplayer player setup */
    #multiplayerSetup {
      margin-top: 25px;
      border: 1.5px solid #6f47ff;
      border-radius: 12px;
      padding: 20px;
      background: #1a1a2e;
      box-shadow: 0 0 15px #6f47ff44;
      display: none;
    }

    #playerCountSelect {
      width: 100%;
      margin-bottom: 15px;
    }

    .playerNameInput {
      margin-bottom: 12px;
      width: 100%;
    }
  </style>
</head>

<body>
  <h1>Guess the Song Game</h1>

  <label for="modeSelect">Choose Mode:</label>
  <select id="modeSelect">
    <option value="infinite">Infinite Mode</option>
    <option value="challenge">Challenge Mode (5 songs, 25 points)</option>
    <option value="multiplayer">Multiplayer Mode</option>
  </select>

  <input id="playlistUrl" type="text" placeholder="Paste Spotify Playlist URL here" />
  <button onclick="loadPlaylist()">Load Playlist</button>

  <div id="loader"></div>

  <p id="message"></p>

  <div id="multiplayerSetup">
    <label for="playerCountSelect">Number of Players:</label>
    <select id="playerCountSelect">
      <option value="2">2 Players</option>
      <option value="3">3 Players</option>
      <option value="4">4 Players</option>
      <option value="5">5 Players</option>
      <option value="6">6 Players</option>
    </select>
    <div id="playerNamesContainer"></div>
    <button id="startMultiplayerBtn" onclick="startMultiplayerGame()">Start Multiplayer Game</button>
  </div>

  <div id="gameControls" style="display:none;">
    <p><strong>Score:</strong> <span id="scoreDisplay">0</span></p>
    <p id="currentPlayerDisplay" style="color:#b892ff; font-weight:700;"></p>

    <div id="buttonRow">
      <button id="playBtn" onclick="playHint()">Play</button>
      <button id="nextHintBtn" onclick="nextHint()">Next Hint</button>
      <button id="giveUpBtn" onclick="revealAnswer()">I Give Up</button>
      <button id="nextSongBtn" style="display:none;">Next Song</button>
    </div>

    <div style="margin-top: 20px;">
      <div class="input-container">
        <input id="guessSongInput" type="text" placeholder="Guess the song name..." autocomplete="off" />
        <div id="songAutocomplete" class="autocomplete-list" style="display:none;"></div>
      </div>
      <div class="input-container">
        <input id="guessArtistInput" type="text" placeholder="Guess the artist name..." autocomplete="off" />
        <div id="artistAutocomplete" class="autocomplete-list" style="display:none;"></div>
      </div>
      <button id="submitGuessBtn" onclick="submitGuess()">Submit Guess</button>
    </div>

    <p id="hintDuration"></p>
    <p id="feedback"></p>
    <p id="answer" style="display:none;"></p>
  </div>

  <button id="playAgainBtn" onclick="playAgain()" style="display:none; margin-top: 30px;">Play Again</button>

  <div id="scoreboard" style="display:none; margin-top: 25px; border: 1.5px solid #6f47ff; border-radius: 12px; padding: 20px; background: #1a1a2e; box-shadow: 0 0 15px #6f47ff44;">
  </div>

  <script>
    const backendUrl = 'https://guess-the-song-backend.onrender.com';
    let songs = [];
    let usedSongs = new Set();
    let currentSong = null;
    let audio = null;
    let hintStages = [0.5, 1, 2, 5, 10, 15];
    let scoring = [10, 8, 6, 4, 2, 1];
    let currentHintIndex = 0;
    let snippetTimeout = null;
    let score = 0;
    let roundOver = false;

    let mode = 'infinite';
    const challengeMaxSongs = 5;
    const challengeGoalPoints = 25;
    let songsPlayed = 0;

    // Multiplayer state
    let players = [];
    let currentPlayerIndex = 0;
    let currentRound = 1;
    const totalRounds = 5;

    const messageP = document.getElementById('message');
    const loader = document.getElementById('loader');
    const gameControls = document.getElementById('gameControls');
    const currentPlayerDisplay = document.getElementById('currentPlayerDisplay');
    const multiplayerSetup = document.getElementById('multiplayerSetup');
    const playerCountSelect = document.getElementById('playerCountSelect');
    const playerNamesContainer = document.getElementById('playerNamesContainer');
    const nextSongBtn = document.getElementById('nextSongBtn');

    // Update player name inputs on player count change
    playerCountSelect.addEventListener('change', () => {
      updatePlayerNameInputs();
    });

    // Initialize player name inputs on page load
    updatePlayerNameInputs();

    function updatePlayerNameInputs() {
      playerNamesContainer.innerHTML = '';
      const count = parseInt(playerCountSelect.value, 10);
      for (let i = 0; i < count; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = `Player ${i + 1} Name`;
        input.className = 'playerNameInput';
        playerNamesContainer.appendChild(input);
      }
    }

    // Mode select change handler to show/hide multiplayer setup
    document.getElementById('modeSelect').addEventListener('change', () => {
      const newMode = document.getElementById('modeSelect').value;
      mode = newMode;
      resetGameUIForMode();
    });

    function resetGameUIForMode() {
      usedSongs.clear();
      score = 0;
      songsPlayed = 0;
      currentHintIndex = 0;
      roundOver = false;
      currentSong = null;
      currentPlayerIndex = 0;
      currentRound = 1;
      players = [];
      messageP.textContent = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('answer').style.display = 'none';
      document.getElementById('answer').textContent = '';
      document.getElementById('hintDuration').textContent = '';
      document.getElementById('guessSongInput').value = '';
      document.getElementById('guessArtistInput').value = '';
      hideAutocomplete('songAutocomplete');
      hideAutocomplete('artistAutocomplete');
      updateScoreDisplay();

      if (mode === 'multiplayer') {
        multiplayerSetup.style.display = 'block';
        gameControls.style.display = 'none';
        document.getElementById('playAgainBtn').style.display = 'none';
        document.getElementById('scoreboard').style.display = 'none';
      } else {
        multiplayerSetup.style.display = 'none';
        gameControls.style.display = 'none';
        document.getElementById('playAgainBtn').style.display = 'none';
        document.getElementById('scoreboard').style.display = 'none';
      }
    }

    // Load playlist function updated to show multiplayer setup if needed
    async function loadPlaylist() {
      const playlistUrl = document.getElementById('playlistUrl').value.trim();
      const playlistId = extractPlaylistId(playlistUrl);

      if (!playlistId) {
        alert('Please enter a valid Spotify playlist URL.');
        return;
      }

      loader.style.display = 'block';

      try {
        const response = await fetch(`${backendUrl}/playlist/${playlistId}`);
        if (!response.ok) {
          alert('Failed to load playlist.');
          loader.style.display = 'none';
          return;
        }

        const data = await response.json();
        songs = data.filter(song => song.preview_url);
        if (songs.length === 0) {
          alert('No playable songs found.');
          loader.style.display = 'none';
          return;
        }

        songsPlayed = 0;
        score = 0;
        updateScore(0);
        resetButtons(true);
        enableInputs(true);
        messageP.textContent = '';

        if (mode === 'multiplayer') {
          multiplayerSetup.style.display = 'block';
          gameControls.style.display = 'none';
          document.getElementById('playAgainBtn').style.display = 'none';
          document.getElementById('scoreboard').style.display = 'none';
          messageP.textContent = 'Playlist loaded! Enter player names and start multiplayer game.';
        } else {
          multiplayerSetup.style.display = 'none';
          gameControls.style.display = 'block';
          document.getElementById('playAgainBtn').style.display = 'none';
          document.getElementById('scoreboard').style.display = 'none';
          startNewRound();
        }
      } catch (error) {
        console.error('Error loading playlist:', error);
        alert('Something went wrong.');
      } finally {
        loader.style.display = 'none';
      }
    }

    // Multiplayer game start
    function startMultiplayerGame() {
      // Read player names and validate
      players = [];
      const inputs = playerNamesContainer.querySelectorAll('input');
      for (const input of inputs) {
        const name = input.value.trim();
        if (!name) {
          alert('Please enter all player names.');
          return;
        }
        players.push({ name, score: 0 });
      }
      if (players.length < 2) {
        alert('At least 2 players are required for multiplayer mode.');
        return;
      }

      // Reset multiplayer state
      usedSongs.clear();
      currentPlayerIndex = 0;
      currentRound = 1;
      roundOver = false;
      score = 0;
      songsPlayed = 0;
      currentHintIndex = 0;
      currentSong = null;
      messageP.textContent = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('answer').style.display = 'none';
      document.getElementById('answer').textContent = '';
      document.getElementById('hintDuration').textContent = '';
      document.getElementById('guessSongInput').value = '';
      document.getElementById('guessArtistInput').value = '';
      hideAutocomplete('songAutocomplete');
      hideAutocomplete('artistAutocomplete');

      multiplayerSetup.style.display = 'none';
      gameControls.style.display = 'block';
      document.getElementById('playAgainBtn').style.display = 'none';
      document.getElementById('scoreboard').style.display = 'none';
      resetButtons(true);
      enableInputs(true);

      updateCurrentPlayerDisplay();
      startNewTurn();
    }

    // Multiplayer turn logic
    function startNewTurn() {
      if (currentRound > totalRounds) {
        endMultiplayerGame();
        return;
      }

      roundOver = false;
      resetButtons(true);
      enableInputs(true);

      clearTimeout(snippetTimeout);
      if (audio) {
        audio.pause();
        audio = null;
      }

      currentHintIndex = 0;
      document.getElementById('answer').style.display = 'none';
      document.getElementById('answer').textContent = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('hintDuration').textContent = '';
      document.getElementById('guessSongInput').value = '';
      document.getElementById('guessArtistInput').value = '';
      hideAutocomplete('songAutocomplete');
      hideAutocomplete('artistAutocomplete');

      // Pick unused song
      let attempts = 0;
      do {
        currentSong = songs[Math.floor(Math.random() * songs.length)];
        attempts++;
      } while (usedSongs.has(currentSong.name + currentSong.artist) && attempts < 20);

      usedSongs.add(currentSong.name + currentSong.artist);
      songsPlayed++;

      messageP.textContent = `Round ${currentRound} / ${totalRounds} â€” ${players[currentPlayerIndex].name}'s turn`;
      updateCurrentPlayerDisplay();
      nextSongBtn.style.display = 'none';
    }

    // Overwrite nextSongBtn behavior for multiplayer
    nextSongBtn.onclick = function () {
      if (mode === 'multiplayer') {
        advanceTurn();
      } else {
        startNewRound();
      }
    };

    // Advance turn to next player / round
    function advanceTurn() {
      players[currentPlayerIndex].score += score;
      score = 0;
      updateScoreDisplay();

      currentPlayerIndex++;
      if (currentPlayerIndex >= players.length) {
        currentPlayerIndex = 0;
        currentRound++;
      }

      if (currentRound > totalRounds) {
        endMultiplayerGame();
      } else {
        startNewTurn();
      }
    }

    function updateCurrentPlayerDisplay() {
      if (mode === 'multiplayer') {
        currentPlayerDisplay.textContent = `Current Player: ${players[currentPlayerIndex].name} | Score: ${players[currentPlayerIndex].score}`;
      } else {
        currentPlayerDisplay.textContent = '';
      }
    }

    function updateScoreDisplay() {
      if (mode === 'multiplayer') {
        // Show current player's score in scoreDisplay
        document.getElementById('scoreDisplay').textContent = players[currentPlayerIndex]?.score?.toFixed(1) || '0';
      } else {
        document.getElementById('scoreDisplay').textContent = Math.round(score * 10) / 10;
      }
    }

    // Modified startNewRound to handle non-multiplayer modes
    function startNewRound() {
      if (mode === 'challenge' && songsPlayed >= challengeMaxSongs) {
        endGame();
        return;
      }

      roundOver = false;
      resetButtons(true);
      enableInputs(true);

      clearTimeout(snippetTimeout);
      if (audio) {
        audio.pause();
        audio = null;
      }

      currentHintIndex = 0;
      document.getElementById('answer').style.display = 'none';
      document.getElementById('answer').textContent = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('hintDuration').textContent = '';
      document.getElementById('guessSongInput').value = '';
      document.getElementById('guessArtistInput').value = '';
      hideAutocomplete('songAutocomplete');
      hideAutocomplete('artistAutocomplete');

      let attempts = 0;
      do {
        currentSong = songs[Math.floor(Math.random() * songs.length)];
        attempts++;
      } while (usedSongs.has(currentSong.name + currentSong.artist) && attempts < 10);

      usedSongs.add(currentSong.name + currentSong.artist);
      songsPlayed++;

      if (mode === 'challenge') {
        messageP.textContent = `Challenge Mode: Song ${songsPlayed} of ${challengeMaxSongs}`;
      } else {
        messageP.textContent = '';
      }
      document.getElementById('playAgainBtn').style.display = 'none';
      nextSongBtn.style.display = 'none';
      updateScoreDisplay();
      currentPlayerDisplay.textContent = '';
    }

    // Play hint stays the same for multiplayer
    function playHint(durationOverride = null) {
      if (!currentSong || !currentSong.preview_url) {
        alert('No preview available.');
        return;
      }

      if (audio) {
        audio.pause();
        audio = null;
      }

      const duration = durationOverride || hintStages[currentHintIndex];
      document.getElementById('hintDuration').textContent = `ðŸŽ§ Playing hint: ${duration} second${duration > 1 ? 's' : ''}`;

      audio = new Audio(currentSong.preview_url);
      audio.currentTime = 0;

      audio.play().then(() => {
        if (!durationOverride) {
          snippetTimeout = setTimeout(() => {
            audio.pause();
          }, duration * 1000);
        } else {
          snippetTimeout = null;
        }
      }).catch(err => {
        console.error('Audio playback error:', err);
      });
    }

    function nextHint() {
      if (roundOver) return;
      currentHintIndex++;
      if (currentHintIndex >= hintStages.length) {
        revealAnswer(true);
      } else {
        playHint();
      }
    }

    function submitGuess() {
      if (roundOver) return;

      const guessSong = document.getElementById('guessSongInput').value.trim().toLowerCase();
      const guessArtist = document.getElementById('guessArtistInput').value.trim().toLowerCase();
      const songName = currentSong.name.toLowerCase();
      const artistName = currentSong.artist.toLowerCase();

      if (!guessSong && !guessArtist) {
        alert('Please enter a guess for the song or the artist.');
        return;
      }

      const matchSong = guessSong && (songName.includes(guessSong) || guessSong.includes(songName));
      const matchArtist = guessArtist && (artistName.includes(guessArtist) || guessArtist.includes(artistName));
      const matchBoth = matchSong && matchArtist;

      const feedbackEl = document.getElementById('feedback');
      const points = scoring[currentHintIndex] || 0;

      if (matchBoth) {
        feedbackEl.textContent = `âœ… Correct! You guessed both song and artist. +${points} pts`;
        score = points;
        updatePlayerScore(points);
        showAnswer();
        playHint(30);
        roundOver = true;
        resetButtons(false);
        nextSongBtn.style.display = 'inline-block';
      } else if (matchSong || matchArtist) {
        const partialPoints = points / 2;
        feedbackEl.textContent = `ðŸŸ¡ Partial match! +${partialPoints} pts`;
        score = partialPoints;
        updatePlayerScore(partialPoints);
        showAnswer();
        playHint(30);
        roundOver = true;
        resetButtons(false);
        nextSongBtn.style.display = 'inline-block';
      } else {
        feedbackEl.textContent = `âŒ Nope! Try again or use a hint.`;
      }
    }

    // Update current player's score in multiplayer or overall score in single
    function updatePlayerScore(points) {
      if (mode === 'multiplayer') {
        players[currentPlayerIndex].score += points;
        updateScoreDisplay();
      } else {
        score += points;
        updateScoreDisplay();
      }
    }

    function showAnswer() {
      const answerEl = document.getElementById('answer');
      answerEl.textContent = `ðŸŽµ ${currentSong.name} â€” ${currentSong.artist}`;
      answerEl.style.display = 'block';
      document.getElementById('hintDuration').textContent = '';
    }

    function revealAnswer(playFull = true) {
      if (roundOver) return;
      showAnswer();
      roundOver = true;
      resetButtons(false);
      nextSongBtn.style.display = 'inline-block';

      if (playFull && currentSong.preview_url) {
        if (audio) audio.pause();
        audio = new Audio(currentSong.preview_url);
        audio.play();
      }
    }

    function endGame() {
      resetButtons(false);
      enableInputs(false);
      nextSongBtn.style.display = 'none';

      if (score >= challengeGoalPoints) {
        messageP.textContent = `ðŸŽ‰ Congratulations! You scored ${Math.round(score)} points and won the challenge!`;
      } else {
        messageP.textContent = `Game Over! You scored ${Math.round(score)} points. Try again to reach ${challengeGoalPoints} points.`;
      }

      if (audio) {
        audio.pause();
        audio = null;
      }
      if (mode === 'challenge') {
        document.getElementById('playAgainBtn').style.display = 'inline-block';
      }
    }

    // Show multiplayer scoreboard at end
    function endMultiplayerGame() {
      resetButtons(false);
      enableInputs(false);
      nextSongBtn.style.display = 'none';
      currentPlayerDisplay.textContent = '';
      messageP.textContent = 'Game Over! Final Scores:';

      if (audio) {
        audio.pause();
        audio = null;
      }

      // Sort players by score descending
      const sortedPlayers = [...players].sort((a, b) => b.score - a.score);

      // Build scoreboard HTML
      const scoreboard = document.getElementById('scoreboard');
      scoreboard.innerHTML = '<h3>Multiplayer Final Scores</h3><ol>';
      sortedPlayers.forEach(p => {
        scoreboard.innerHTML += `<li>${p.name}: ${p.score.toFixed(1)} pts</li>`;
      });
      scoreboard.innerHTML += '</ol>';

      scoreboard.style.display = 'block';
      document.getElementById('playAgainBtn').style.display = 'inline-block';
    }

    function playAgain() {
      usedSongs.clear();
      score = 0;
      songsPlayed = 0;
      currentHintIndex = 0;
      roundOver = false;
      currentSong = null;
      currentPlayerIndex = 0;
      currentRound = 1;
      players = [];
      messageP.textContent = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('answer').style.display = 'none';
      document.getElementById('scoreboard').style.display = 'none';
      document.getElementById('playAgainBtn').style.display = 'none';
      enableInputs(true);
      resetButtons(true);
      updateScoreDisplay();
      currentPlayerDisplay.textContent = '';
      if (mode === 'multiplayer') {
        multiplayerSetup.style.display = 'block';
        gameControls.style.display = 'none';
      } else {
        multiplayerSetup.style.display = 'none';
        gameControls.style.display = 'block';
        startNewRound();
      }
    }

    function resetButtons(active) {
      document.getElementById('playBtn').disabled = !active;
      document.getElementById('nextHintBtn').disabled = !active;
      document.getElementById('giveUpBtn').disabled = !active;
      document.getElementById('submitGuessBtn').disabled = !active;
      nextSongBtn.style.display = active ? 'none' : 'inline-block';
    }

    function enableInputs(enabled) {
      document.getElementById('guessSongInput').disabled = !enabled;
      document.getElementById('guessArtistInput').disabled = !enabled;
    }

    function extractPlaylistId(url) {
      const match = url.match(/playlist\/([a-zA-Z0-9]+)(\?.*)?$/);
      return match ? match[1] : null;
    }

    // Autocomplete functions unchanged
    function showAutocomplete(listId, matches, inputElement) {
      const list = document.getElementById(listId);
      list.innerHTML = '';
      if (matches.length === 0) {
        list.style.display = 'none';
        return;
      }
      matches.forEach(item => {
        const div = document.createElement('div');
        div.textContent = item;
        div.className = 'autocomplete-item';
        div.onclick = () => {
          inputElement.value = item;
          hideAutocomplete(listId);
          inputElement.focus();
        };
        list.appendChild(div);
      });
      list.style.display = 'block';
    }

    function hideAutocomplete(listId) {
      const list = document.getElementById(listId);
      list.style.display = 'none';
      list.innerHTML = '';
    }

    document.getElementById('guessSongInput').addEventListener('input', function () {
      const val = this.value.trim().toLowerCase();
      if (!val) {
        hideAutocomplete('songAutocomplete');
        return;
      }
      const songMatches = [...new Set(songs
        .map(s => s.name)
        .filter(name => name.toLowerCase().includes(val))
        .slice(0, 10)
      )];
      showAutocomplete('songAutocomplete', songMatches, this);
    });

    document.getElementById('guessArtistInput').addEventListener('input', function () {
      const val = this.value.trim().toLowerCase();
      if (!val) {
        hideAutocomplete('artistAutocomplete');
        return;
      }
      const artistSet = new Set();
      songs.forEach(s => {
        s.artist.split(',').forEach(a => artistSet.add(a.trim()));
      });
      const artistMatches = [...artistSet]
        .filter(name => name.toLowerCase().includes(val))
        .slice(0, 10);
      showAutocomplete('artistAutocomplete', artistMatches, this);
    });

    document.addEventListener('click', function (e) {
      if (!document.getElementById('guessSongInput').contains(e.target)) {
        hideAutocomplete('songAutocomplete');
      }
      if (!document.getElementById('guessArtistInput').contains(e.target)) {
        hideAutocomplete('artistAutocomplete');
      }
    });
  </script>
</body>

</html>
